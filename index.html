<!DOCTYPE html>
<html lang="id">
  <head>
    <title>Virtual Tour 360° IPB - Masjid Al-Hurriyyah | Explore Al-Hurriyyah VR</title>
    <meta name="description" content="Jelajahi virtual tour 360° interaktif kawasan Masjid Al-Hurriyyah IPB dengan 11 lokasi menarik menggunakan teknologi VR berbasis web. Nikmati pengalaman immersive berkeliling kampus IPB." />
    <meta name="keywords" content="virtual tour, 360°, VR, IPB, Masjid Al-Hurriyyah, panorama, virtual reality, kampus IPB, tour interaktif, explore IPB, IPB Bogor" />
    <meta name="author" content="Kelompok 3 K3 Grafika Komputer dan Visualisasi IPB" />
    <meta name="robots" content="index, follow" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width, shrink-to-fit=no" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Virtual Tour 360° IPB - Masjid Al-Hurriyyah" />
    <meta property="og:description" content="Nikmati tour Virtual Reality (VR) berbasis web dengan navigasi 360° untuk mengeksplorasi 11 lokasi menarik di sekitar Masjid Al-Hurriyyah IPB." />
    <meta property="og:image" content="https://explore-alhurriyah-vr.vercel.app/images/PetaIPB.png" />
    <meta property="og:url" content="https://explore-alhurriyah-vr.vercel.app/" />
    <meta property="og:site_name" content="Explore Al-Hurriyyah VR" />
    <meta property="og:locale" content="id_ID" />
    
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content="Virtual Tour 360° IPB - Masjid Al-Hurriyyah" />
    <meta property="twitter:description" content="Jelajahi 11 lokasi menarik di kawasan Masjid Al-Hurriyyah IPB dengan teknologi VR 360°" />
    <meta property="twitter:image" content="https://explore-alhurriyah-vr.vercel.app/images/PetaIPB.png" />
    <meta property="twitter:site" content="@IPBUniversity" />
    
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="manifest" href="manifest.json" />
    
    <meta name="theme-color" content="#EBAD06" />
    <meta name="msapplication-TileColor" content="#1e3c72" />
    
    <link rel="preload" href="images/PetaIPB.png" as="image" />
    <link rel="preload" href="css/font-awesome.css" as="style" />
    <link rel="preload" href="style.css" as="style" />
    <link rel="preload" href="panoramas/Titik_Utama.jpg" as="image" />
    
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Virtual Tour 360° IPB - Masjid Al-Hurriyyah",
      "description": "Virtual tour 360° interaktif kawasan Masjid Al-Hurriyyah IPB dengan 11 lokasi menarik menggunakan teknologi VR berbasis web",
      "url": "https://explore-alhurriyah-vr.vercel.app/",
      "applicationCategory": "Educational",
      "operatingSystem": "Web Browser",
      "author": {
        "@type": "Organization",
        "name": "Kelompok 3 K3 Grafika Komputer dan Visualisasi IPB",
        "url": "https://ipb.ac.id"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Institut Pertanian Bogor",
        "url": "https://ipb.ac.id"
      },
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "IDR"
      },
      "screenshot": "https://explore-alhurriyah-vr.vercel.app/images/PetaIPB.png",
      "datePublished": "2025-01-27",
      "dateModified": "2025-01-27",
      "inLanguage": "id"
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Place",
      "name": "Masjid Al-Hurriyyah IPB",
      "description": "Masjid kampus Institut Pertanian Bogor dengan fasilitas lengkap dan arsitektur modern",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Jl. Raya Dramaga",
        "addressLocality": "Dramaga",
        "addressRegion": "Bogor",
        "postalCode": "16680",
        "addressCountry": "ID"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": -6.5545,
        "longitude": 106.7276
      },
      "url": "https://explore-alhurriyah-vr.vercel.app/",
      "image": "https://explore-alhurriyah-vr.vercel.app/panoramas/Lantai_1_AlHurriyyah.jpg",
      "containedInPlace": {
        "@type": "CollegeOrUniversity",
        "name": "Institut Pertanian Bogor",
        "url": "https://ipb.ac.id"
      }
    }
    </script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XXXXXXXXXX', {
        page_title: 'Virtual Tour 360° IPB - Masjid Al-Hurriyyah',
        page_location: 'https://explore-alhurriyah-vr.vercel.app/'
      });
    </script>

    <style>
      body{margin:0;padding:0;font-family:Arial,sans-serif;background:#4a4a4a;color:#fff;overflow:hidden}
      #landingPage{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:10}
      .landing-content{display:flex;width:100vw;height:100vh;background:linear-gradient(135deg,#1e3c72 0%,#2a5298 100%)}
      .loading-spinner{width:60px;height:60px;border:4px solid rgba(235,173,6,.3);border-top:4px solid #EBAD06;border-radius:50%;animation:spin 1s linear infinite}
      @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
      .hidden{display:none!important}
    </style>
    
    <link rel="stylesheet" type="text/css" href="css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="style.css" />

    <script>
      if (typeof module === "object") {
        window.module = module;
        module = undefined;
      }
    </script>

    <script src="js/jquery.js"></script>
    <script src="js/imagedata.js"></script>

    <script>
      if (window.module) module = window.module;
      
      // Error handling
      window.addEventListener('error', function(e) {
        console.error('Runtime error:', e.error);
        gtag('event', 'exception', {
          description: e.error.toString(),
          fatal: false
        });
      });
      
      // Service Worker registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/sw.js')
            .then(function(registration) {
              console.log('SW registered: ', registration);
            })
            .catch(function(registrationError) {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
      
      // Performance monitoring
      window.addEventListener('load', function() {
        if ('performance' in window) {
          const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
          gtag('event', 'timing_complete', {
            name: 'load',
            value: loadTime
          });
        }
      });
    </script>
  </head>
  <body id="body">
    <div id="landingPage">
      <div class="landing-content">
        <div class="landing-left">
          <div class="map-container">
            <img src="images/PetaIPB.png" alt="Peta IPB" class="map-image" />
            <div class="map-overlay"></div>
          </div>
        </div>

        <div class="landing-right">
          <div class="landing-title">
            360 Virtual Reality Tour: Navigasi Kawasan Sekitar Masjid
            Al-Hurriyyah
          </div>
          <div class="landing-subtitle">
            Nikmati tour Virtual Reality (VR) berbasis web dengan navigasi 360°
            untuk mengeksplorasi 11 lokasi menarik di sekitar Masjid
            Al-Hurriyyah IPB!
          </div>

          <div class="locations-container">
            <div class="locations-grid">
              <button
                class="location-btn"
                onclick="startTourAt('Titik_Utama.jpg')"
              >
                <span class="location-number">1</span>
                <span class="location-text">Titik Utama</span>
              </button>
              <button
                class="location-btn"
                onclick="startTourAt('Auditorium_FMIPA.jpg')"
              >
                <span class="location-number">2</span>
                <span class="location-text">Auditorium FMIPA</span>
              </button>
              <button
                class="location-btn"
                onclick="startTourAt('Blue_Corner.jpg')"
              >
                <span class="location-number">3</span>
                <span class="location-text">Kantin Blue Corner</span>
              </button>
              <button
                class="location-btn"
                onclick="startTourAt('Depan_Biokim.jpg')"
              >
                <span class="location-number">4</span>
                <span class="location-text">Gedung Biokimia</span>
              </button>
              <button class="location-btn" onclick="startTourAt('FPIK.jpg')">
                <span class="location-number">5</span>
                <span class="location-text">Gedung FPIK</span>
              </button>
              <button class="location-btn" onclick="startTourAt('GOR.jpg')">
                <span class="location-number">6</span>
                <span class="location-text">Gedung Olahraga (GOR)</span>
              </button>
              <button
                class="location-btn"
                onclick="startTourAt('International_Student_Center.jpg')"
              >
                <span class="location-number">7</span>
                <span class="location-text">International Student Center</span>
              </button>
              <button
                class="location-btn"
                onclick="startTourAt('Lantai_1_AlHurriyyah.jpg')"
              >
                <span class="location-number">8</span>
                <span class="location-text">Masjid Al-Hurriyyah Lt.1</span>
              </button>
              <button
                class="location-btn"
                onclick="startTourAt('Lantai_2_AlHurriyah.jpg')"
              >
                <span class="location-number">9</span>
                <span class="location-text">Masjid Al-Hurriyyah Lt.2</span>
              </button>
              <button
                class="location-btn"
                onclick="startTourAt('Parkiran_AlHurriyyah.jpg')"
              >
                <span class="location-number">10</span>
                <span class="location-text">Parkiran Masjid Al-Hurriyyah</span>
              </button>
              <button class="location-btn" onclick="startTourAt('Satari.jpg')">
                <span class="location-number">11</span>
                <span class="location-text">Gedung SATARI</span>
              </button>
            </div>

            <button class="start-tour-btn" onclick="startDefaultTour()">
              Mulai Tour dari Titik Utama
            </button>

            <div class="developer-info">
              <div class="developer-title">
                Dikembangkan oleh Kelompok 3 K3 Grafika Komputer dan Visualisasi
              </div>
              <div class="developer-list">
                Husni Abdillah (G64012312097) | Afif Fakhri Muhammad (G6401231007) | Daffa Naufal Mumtaz Heryadi (G6401231168)
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="container"></div>

    <div id="overlay">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <div class="loading-text pulse" id="loadingText">
          Loading panorama...
        </div>
        <div class="loading-progress">
          <div class="loading-progress-bar" id="loadingProgressBar"></div>
        </div>
      </div>
    </div>

    <div id="tmp">
      <div
        style="
          width: 100%;
          height: 100%;
          overflow: hidden;
          overflow-y: auto;
          box-sizing: border-box;
          position: relative;
        "
        id="tmpcontent"
      ></div>
      <div class="mediaclosebutton" onclick="hideTemp()">
        <i class="fa fa-times-circle"></i>
      </div>
    </div>

    <div id="audioPlayer" class="audio-player">
      <div class="audio-controls">
        <button id="prevBtn" class="audio-btn">⏮</button>
        <button id="playPauseBtn" class="audio-btn">▶</button>
        <button id="nextBtn" class="audio-btn">⏭</button>
      </div>
      <div class="audio-progress">
        <div id="progressBar" class="progress-bar"></div>
      </div>
    </div>

    <button
      id="homeButton"
      class="home-button"
      onclick="goToHome()"
      title="Kembali ke Beranda"
    >
      <i class="fa fa-home"></i>
    </button>

    <button
      id="hamburgerButton"
      class="hamburger-button"
      onclick="togglePanoList()"
      title="Menu Panorama"
    >
      <i class="fa fa-bars"></i>
    </button>

    <div
      id="panolistOverlay"
      class="panolist-overlay"
      onclick="closePanoList()"
    ></div>

    <script src="js/three.min.js"></script>
    <script src="js/OrbitControls.js"></script>

    <script>
      let scene, camera, renderer, controls;
      let spriteHotspots = [];

      let panoramaMesh;

      let targetFov = 75;
      let initialFov = 75;
      let initialPinchDistance = null;

      const overlay = document.getElementById("overlay");
      const raycaster = new THREE.Raycaster();
      const mouse = new THREE.Vector2();

      class PanoramaPreloader {
        constructor() {
          this.cache = new Map();
          this.preloadQueue = [];
        }

        preloadTexture(panoramaName) {
          if (this.cache.has(panoramaName)) return;

          const loader = new THREE.TextureLoader();
          loader.load(`panoramas/${panoramaName}`, (texture) => {
            this.cache.set(panoramaName, texture);
            console.log(`Preloaded: ${panoramaName}`);
          });
        }

        getTexture(panoramaName) {
          return this.cache.get(panoramaName);
        }

        preloadNearbyPanoramas(currentPanorama) {
          const nearbyMap = {
            "Titik_Utama.jpg": [
              "GOR.jpg",
              "Parkiran_AlHurriyyah.jpg",
              "Satari.jpg",
              "International_Student_Center.jpg",
              "Depan_Biokim.jpg",
            ],
            "GOR.jpg": [
              "Titik_Utama.jpg",
              "Blue_Corner.jpg",
              "FPIK.jpg",
              "Satari.jpg",
              "International_Student_Center.jpg",
            ],
            "Parkiran_AlHurriyyah.jpg": [
              "Titik_Utama.jpg",
              "Lantai_1_AlHurriyyah.jpg",
              "Lantai_2_AlHurriyah.jpg",
            ],
            "International_Student_Center.jpg": [
              "GOR.jpg",
              "Titik_Utama.jpg",
              "Auditorium_FMIPA.jpg",
            ],
            "Depan_Biokim.jpg": [
              "Titik_Utama.jpg",
              "Auditorium_FMIPA.jpg",
              "International_Student_Center.jpg",
            ],
            "FPIK.jpg": ["GOR.jpg", "Satari.jpg"],
            "Satari.jpg": ["FPIK.jpg", "GOR.jpg", "Parkiran_AlHurriyyah.jpg"],
            "Blue_Corner.jpg": ["GOR.jpg"],
            "Auditorium_FMIPA.jpg": [
              "Depan_Biokim.jpg",
              "International_Student_Center.jpg",
            ],
            "Lantai_1_AlHurriyyah.jpg": [
              "Lantai_2_AlHurriyah.jpg",
              "Parkiran_AlHurriyyah.jpg",
            ],
            "Lantai_2_AlHurriyah.jpg": [
              "Lantai_1_AlHurriyyah.jpg",
              "Parkiran_AlHurriyyah.jpg",
            ],
          };

          if (nearbyMap[currentPanorama]) {
            nearbyMap[currentPanorama].forEach((pano) => {
              setTimeout(() => this.preloadTexture(pano), 1000);
            });
          }
        }
      }

      const preloader = new PanoramaPreloader();

      class AudioManager {
        constructor() {
          this.audioFiles = [
            {
              src: "audios/Allison&VexentoBananaBreeze.mp3",
              title: "Allison & Vexento - Banana Breeze",
            },
            {
              src: "audios/VexentoHome.mp3",
              title: "Vexento - Home",
            },
            {
              src: "audios/VexentoNoTurningBack.mp3",
              title: "Vexento - No Turning Back",
            },
          ];

          this.currentIndex = 0;
          this.audio = new Audio();
          this.isPlaying = false;
          this.isInitialized = false;

          this.initializeAudio();
          this.setupEventListeners();
        }

        initializeAudio() {
          this.audio.src = this.audioFiles[this.currentIndex].src;
          this.audio.loop = false;
          this.audio.volume = 0.5;

          // Audio event listeners
          this.audio.addEventListener("ended", () => {
            this.nextTrack();
          });

          this.audio.addEventListener("timeupdate", () => {
            this.updateProgress();
          });

          this.audio.addEventListener("loadedmetadata", () => {});
        }

        setupEventListeners() {
          const playPauseBtn = document.getElementById("playPauseBtn");
          const prevBtn = document.getElementById("prevBtn");
          const nextBtn = document.getElementById("nextBtn");

          playPauseBtn.addEventListener("click", () => {
            this.togglePlayPause();
          });

          prevBtn.addEventListener("click", () => {
            this.prevTrack();
          });

          nextBtn.addEventListener("click", () => {
            this.nextTrack();
          });

          document.addEventListener(
            "click",
            () => {
              if (!this.isInitialized) {
                this.play();
                this.isInitialized = true;
              }
            },
            { once: true }
          );
        }

        togglePlayPause() {
          if (this.isPlaying) {
            this.pause();
          } else {
            this.play();
          }
        }

        play() {
          this.audio
            .play()
            .then(() => {
              this.isPlaying = true;
              document.getElementById("playPauseBtn").textContent = "⏸";
              
              // Analytics tracking
              gtag('event', 'audio_play', {
                event_category: 'Audio',
                event_label: this.audioFiles[this.currentIndex].title,
                value: 1
              });
            })
            .catch((error) => {
              console.log("Audio play failed:", error);
            });
        }

        pause() {
          this.audio.pause();
          this.isPlaying = false;
          document.getElementById("playPauseBtn").textContent = "▶";
        }

        nextTrack() {
          this.currentIndex = (this.currentIndex + 1) % this.audioFiles.length;
          this.loadCurrentTrack();
        }

        prevTrack() {
          this.currentIndex =
            this.currentIndex === 0
              ? this.audioFiles.length - 1
              : this.currentIndex - 1;
          this.loadCurrentTrack();
        }

        loadCurrentTrack() {
          const wasPlaying = this.isPlaying;
          this.audio.src = this.audioFiles[this.currentIndex].src;

          if (wasPlaying) {
            this.audio.addEventListener(
              "loadeddata",
              () => {
                this.play();
              },
              { once: true }
            );
          }
        }

        updateProgress() {
          if (this.audio.duration) {
            const progress =
              (this.audio.currentTime / this.audio.duration) * 100;
            document.getElementById("progressBar").style.width = progress + "%";
          }
        }
      }

      let audioManager;

      // Add staggered animation delays to audio buttons when DOM loads
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
          const audioButtons = document.querySelectorAll(".audio-btn");
          audioButtons.forEach((btn, index) => {
            btn.style.setProperty("--delay", `${index * 0.5}s`);
            btn.style.setProperty("--blink-delay", `${index * 1.2}s`);
          });
        }, 100);
      });

      init();
      animate();

      let currentPanorama = "Titik_Utama.jpg";
      function init() {
        const container = document.getElementById("container");

        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera(
          targetFov,
          container.clientWidth / container.clientHeight,
          0.1,
          1000
        );
        camera.position.set(0, 0, 0.1);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableZoom = true;
        controls.minDistance = 0.1;
        controls.maxDistance = 5;
        controls.enablePan = false;
        controls.rotateSpeed = -0.3;
        controls.enableDamping = true;
        controls.dampingFactor = 0.1;

        const geometry = new THREE.SphereGeometry(500, 60, 40);
        geometry.scale(-1, 1, 1);

        const texture = new THREE.TextureLoader().load(
          "panoramas/Titik_Utama.jpg"
        );
        const material = new THREE.MeshBasicMaterial({ map: texture });

        panoramaMesh = new THREE.Mesh(geometry, material);
        scene.add(panoramaMesh);

        loadHotspotsFor("Titik_Utama.jpg");

        audioManager = new AudioManager();

        setTimeout(() => {
          preloader.preloadNearbyPanoramas("Titik_Utama.jpg");
        }, 2000);

        controls.touches = {
          ONE: THREE.TOUCH.ROTATE,
          TWO: THREE.TOUCH.DOLLY_PAN
        };

        window.addEventListener("resize", onWindowResize);
        renderer.domElement.addEventListener("wheel", onMouseWheel, {
          passive: false,
        });
        renderer.domElement.addEventListener("touchstart", handleTouchStart, {
          passive: false,
        });
        renderer.domElement.addEventListener("touchmove", handleTouchMove, {
          passive: false,
        });
        
        let touchStartTime = 0;
        let touchStartPosition = { x: 0, y: 0 };

        renderer.domElement.addEventListener("touchstart", function(event) {
          if (event.touches.length === 1) {
            touchStartTime = Date.now();
            touchStartPosition.x = event.touches[0].clientX;
            touchStartPosition.y = event.touches[0].clientY;
          }
        }, { passive: true });

        renderer.domElement.addEventListener("touchend", function(event) {
          if (event.changedTouches.length === 1) {
            const touchEndTime = Date.now();
            const touchDuration = touchEndTime - touchStartTime;
            const touchEndPosition = {
              x: event.changedTouches[0].clientX,
              y: event.changedTouches[0].clientY
            };
            
            const moveDistance = Math.sqrt(
              Math.pow(touchEndPosition.x - touchStartPosition.x, 2) +
              Math.pow(touchEndPosition.y - touchStartPosition.y, 2)
            );
            
            if (touchDuration < 300 && moveDistance < 10) {
              handleHotspotInteraction(event);
            }
          }
        }, { passive: false });
        
        renderer.domElement.addEventListener(
          "pointermove",
          onPointerMove,
          false
        );
      }

      function onMouseWheel(e) {
        e.preventDefault();
        targetFov += e.deltaY * 0.05;
        targetFov = THREE.MathUtils.clamp(targetFov, 30, 100);
      }

      function handleTouchStart(e) {
        if (e.touches.length === 2) {
          const dx = e.touches[0].pageX - e.touches[1].pageX;
          const dy = e.touches[0].pageY - e.touches[1].pageY;
          initialPinchDistance = Math.sqrt(dx * dx + dy * dy);
          initialFov = targetFov;
        }
      }

      function handleTouchMove(e) {
        if (e.touches.length === 2 && initialPinchDistance !== null) {
          e.preventDefault();
          const dx = e.touches[0].pageX - e.touches[1].pageX;
          const dy = e.touches[0].pageY - e.touches[1].pageY;
          const newDistance = Math.sqrt(dx * dx + dy * dy);
          const zoomFactor = initialPinchDistance / newDistance;
          targetFov = THREE.MathUtils.clamp(initialFov * zoomFactor, 30, 100);
        }
      }

      function loadHotspotsFor(panorama) {
        clearHotspots();

        if (panorama === "Lantai_2_AlHurriyah.jpg") {
          addHotspot(
            "images/arrowdown.png",
            new THREE.Vector3(
              94.20550868503928,
              -117.26727483157566,
              -369.727097325939
            ),
            () => {
              switchPanorama("Lantai_1_AlHurriyyah.jpg");
            }
          );
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              385.70896296329795,
              -68.31093045055789,
              78.9474553717551
            ),
            () => {
              switchPanorama("Parkiran_AlHurriyyah.jpg");
            }
          );
        }

        if (panorama === "Parkiran_AlHurriyyah.jpg") {
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              348.9064709449308,
              -88.31481535166338,
              -172.63309408705703
            ),
            () => {
              switchPanorama("Titik_Utama.jpg");
            }
          );
          addHotspot(
            "images/chevrontilted.png",
            new THREE.Vector3(
              -345.89072800627315,
              -133.92755007793966,
              148.01923996960738
            ),
            () => {
              switchPanorama("Lantai_1_AlHurriyyah.jpg");
            }
          );
          addHotspot(
            "images/chevronup.png",
            new THREE.Vector3(
              -368.66572271585756,
              -16.885461938738892,
              -151.87198599503432
            ),
            () => {
              switchPanorama("Lantai_2_AlHurriyah.jpg");
            }
          );
          addHotspot(
            "images/chevronup.png",
            new THREE.Vector3(
              -156.424311351119,
              -29.13517650265135,
              366.50518200082695
            ),
            () => {
              switchPanorama("Lantai_2_AlHurriyah.jpg");
            }
          );
        }

        if (panorama === "GOR.jpg") {
          addHotspot(
            "images/chevronleft.png",
            new THREE.Vector3(
              -94.42500992834891,
              -62.18178745841759,
              383.07588877511057
            ),
            () => {
              switchPanorama("Blue_Corner.jpg");
            }
          );
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              345.01732229570996,
              -42.58760815893776,
              -196.89217478216608
            ),
            () => {
              switchPanorama("Titik_Utama.jpg");
            }
          );
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              -208.38305875994945,
              -45.93311017776493,
              337.222852100566
            ),
            () => {
              switchPanorama("FPIK.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              -392.13138873003925,
              -34.82390528004943,
              -66.14807556373327
            ),
            () => {
              switchPanorama("Satari.jpg");
            }
          );
          addHotspot(
            "images/chevronright.png",
            new THREE.Vector3(
              396.55352665607677,
              -47.824155214678854,
              -2.9437437818656886
            ),
            () => {
              switchPanorama("International_Student_Center.jpg");
            }
          );
        }

        if (panorama === "Titik_Utama.jpg") {
          addHotspot(
            "images/chevrontilted.png",
            new THREE.Vector3(
              -297.17318825139273,
              -42.846337826039566,
              263.4738724599001
            ),
            () => {
              switchPanorama("Parkiran_AlHurriyyah.jpg");
            }
          );
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              26.977336443372657,
              -25.2007527890509,
              397.42241008321315
            ),
            () => {
              switchPanorama("Satari.jpg");
            }
          );
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              355.8288995907062,
              -37.42373413004192,
              176.83281053862333
            ),
            () => {
              switchPanorama("GOR.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              342.1237780725438,
              -31.534558582067127,
              -204.18408259899513
            ),
            () => {
              switchPanorama("International_Student_Center.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              90.00199634816356,
              12.599192900948147,
              -388.75754564961096
            ),
            () => {
              switchPanorama("Depan_Biokim.jpg");
            }
          );
        }

        if (panorama === "Auditorium_FMIPA.jpg") {
          addHotspot(
            "images/chevrontilted.png",
            new THREE.Vector3(
              354.33681373800624,
              -51.56556987374783,
              176.0329734729849
            ),
            () => {
              switchPanorama("Depan_Biokim.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              47.088574654837366,
              -23.75247915620768,
              -395.90922217091014
            ),
            () => {
              switchPanorama("International_Student_Center.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              223.20473565238638,
              -17.75021325069963,
              -330.27696872741956
            ),
            () => {
              switchPanorama("Auditorium_FMIPA.jpg");
            }
          );
        }

        if (panorama === "Blue_Corner.jpg") {
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              221.66058693462588,
              -18.849029589679112,
              -331.2218465077597
            ),
            () => {
              switchPanorama("GOR.jpg");
            }
          );
        }

        if (panorama === "Depan_Biokim.jpg") {
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              87.70401564951152,
              -32.31299649313661,
              -388.58507567772017
            ),
            () => {
              switchPanorama("Titik_Utama.jpg");
            }
          );
          addHotspot(
            "images/chevronup.png",
            new THREE.Vector3(
              -346.77304575303305,
              -46.180648599846954,
              -192.3890238040266
            ),
            () => {
              switchPanorama("Auditorium_FMIPA.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              -199.23020098866976,
              -24.18006972043685,
              -345.67212761270804
            ),
            () => {
              switchPanorama("International_Student_Center.jpg");
            }
          );
        }

        if (panorama === "FPIK.jpg") {
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              291.2068160289363,
              -22.257878739357203,
              -272.26477696305307
            ),
            () => {
              switchPanorama("GOR.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              56.44575904945614,
              -30.321269527834936,
              -394.1493957406833
            ),
            () => {
              switchPanorama("Satari.jpg");
            }
          );
        }

        if (panorama === "International_Student_Center.jpg") {
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              85.45700227112748,
              -37.95753771637514,
              -388.4764201021167
            ),
            () => {
              switchPanorama("GOR.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              372.9384204265385,
              -35.06611826140529,
              -138.00131184294546
            ),
            () => {
              switchPanorama("Titik_Utama.jpg");
            }
          );
          addHotspot(
            "images/chevrontilted.png",
            new THREE.Vector3(
              167.99317081350586,
              -38.35805723443793,
              360.2655778248524
            ),
            () => {
              switchPanorama("Auditorium_FMIPA.jpg");
            }
          );
        }

        if (panorama === "Lantai_1_AlHurriyyah.jpg") {
          addHotspot(
            "images/arrowup.png",
            new THREE.Vector3(
              343.4819426447618,
              -34.54316023997859,
              201.44932217652604
            ),
            () => {
              switchPanorama("Lantai_2_AlHurriyah.jpg");
            }
          );
          addHotspot(
            "images/whitetilted.png",
            new THREE.Vector3(
              133.9821577585248,
              -40.1069234612025,
              373.82992659197157
            ),
            () => {
              switchPanorama("Parkiran_AlHurriyyah.jpg");
            }
          );
        }

        if (panorama === "Satari.jpg") {
          addHotspot(
            "images/chevronforward.png",
            new THREE.Vector3(
              232.4559113641139,
              -16.53953102628404,
              324.4291116622447
            ),
            () => {
              switchPanorama("FPIK.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              328.6355572485949,
              -20.816546558590225,
              225.55316229872167
            ),
            () => {
              switchPanorama("GOR.jpg");
            }
          );
          addHotspot(
            "images/white.png",
            new THREE.Vector3(
              248.7198364160254,
              9.65610496581878,
              -311.8442782459645
            ),
            () => {
              switchPanorama("Parkiran_AlHurriyyah.jpg");
            }
          );
        }
      }

      function switchPanorama(panoramaName) {
        // Analytics tracking
        gtag('event', 'panorama_switch', {
          event_category: 'Virtual Tour',
          event_label: panoramaName,
          value: 1
        });
        
        overlay.style.pointerEvents = "auto";
        overlay.style.opacity = "1";
        document.getElementById("loadingText").textContent =
          "Loading panorama...";
        document.getElementById("loadingProgressBar").style.width = "0%";

        const cachedTexture = preloader.getTexture(panoramaName);

        if (cachedTexture) {
          document.getElementById("loadingProgressBar").style.width = "100%";
          document.getElementById("loadingText").textContent = "Ready!";

          panoramaMesh.material.map = cachedTexture;
          panoramaMesh.material.needsUpdate = true;
          currentPanorama = panoramaName;

          setTimeout(() => {
            loadHotspotsFor(currentPanorama);
            preloader.preloadNearbyPanoramas(currentPanorama);
            overlay.style.opacity = "0";
            overlay.style.pointerEvents = "none";
          }, 200);
        } else {
          const newTexture = new THREE.TextureLoader().load(
            `panoramas/${panoramaName}`,
            (tex) => {
              preloader.cache.set(panoramaName, tex);
              panoramaMesh.material.map = tex;
              panoramaMesh.material.needsUpdate = true;
              currentPanorama = panoramaName;

              document.getElementById("loadingProgressBar").style.width =
                "100%";
              document.getElementById("loadingText").textContent = "Ready!";

              setTimeout(() => {
                loadHotspotsFor(currentPanorama);
                preloader.preloadNearbyPanoramas(currentPanorama);
                overlay.style.opacity = "0";
                overlay.style.pointerEvents = "none";
              }, 300);
            },
            (xhr) => {
              if (xhr.lengthComputable) {
                const progress = (xhr.loaded / xhr.total) * 100;
                document.getElementById("loadingProgressBar").style.width =
                  progress + "%";
                document.getElementById(
                  "loadingText"
                ).textContent = `Loading... ${progress.toFixed(0)}%`;
              } else {
                const fakeProgress = Math.min((xhr.loaded / 500000) * 100, 90);
                document.getElementById("loadingProgressBar").style.width =
                  fakeProgress + "%";
                document.getElementById(
                  "loadingText"
                ).textContent = `Loading... ${fakeProgress.toFixed(0)}%`;
              }
            },
            (error) => {
              document.getElementById("loadingText").textContent =
                "Error loading panorama";
              console.error("Loading error:", error);
              setTimeout(() => {
                overlay.style.opacity = "0";
                overlay.style.pointerEvents = "none";
              }, 1000);
            }
          );
        }
      }

      function addHotspot(imageUrl, position, onClickCallback) {
        const textureLoader = new THREE.TextureLoader();
        textureLoader.load(imageUrl, (texture) => {
          const material = new THREE.SpriteMaterial({ map: texture });
          const sprite = new THREE.Sprite(material);
          sprite.position.copy(position);
          
          const isMobile = window.innerWidth <= 768;
          const baseScale = isMobile ? 60 : 40;
          
          sprite.scale.set(baseScale, baseScale, 1);
          sprite.userData = {
            onClick: onClickCallback,
            targetScale: baseScale,
            baseScale: baseScale,
            pulsePhase: Math.random() * Math.PI * 2,
            pulseSpeed: 0.02,
            pulseAmplitude: isMobile ? 12 : 8,
            isHovered: false,
            blinkPhase: Math.random() * Math.PI * 2,
            blinkSpeed: 0.008,
            blinkTimer: Math.random() * 300,
          };
          spriteHotspots.push(sprite);
          scene.add(sprite);
        });
      }

      function clearHotspots() {
        spriteHotspots.forEach((sprite) => scene.remove(sprite));
        spriteHotspots = [];
      }

      function onPointerMove(event) {
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(spriteHotspots);

        spriteHotspots.forEach((sprite) => {
          sprite.userData.isHovered = false;
        });

        if (intersects.length > 0) {
          intersects[0].object.userData.isHovered = true;
          document.body.style.cursor = "pointer";
        } else {
          document.body.style.cursor = "default";
        }
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
        requestAnimationFrame(animate);

        camera.fov += (targetFov - camera.fov) * 0.1;
        camera.updateProjectionMatrix();

        spriteHotspots.forEach((sprite, index) => {
          const userData = sprite.userData;

          userData.pulsePhase += userData.pulseSpeed;

          userData.blinkTimer += 1;

          const pulseScale =
            userData.baseScale +
            Math.sin(userData.pulsePhase) * userData.pulseAmplitude;

          let blinkOpacity = 1;
          if (userData.blinkTimer > 300) {
            const blinkCycle = (userData.blinkTimer - 300) % 60;
            if (blinkCycle < 10) {
              blinkOpacity = 0.3;
            } else if (blinkCycle < 20) {
              blinkOpacity = 1;
            } else if (blinkCycle < 30) {
              blinkOpacity = 0.3;
            } else {
              blinkOpacity = 1;
            }

            if (blinkCycle >= 59) {
              userData.blinkTimer = 0;
            }
          }

          let targetScale = pulseScale;
          if (userData.isHovered) {
            targetScale = userData.baseScale + 15;
            blinkOpacity = 1;
          }

          const currentScale = sprite.scale.x;
          const newScale = THREE.MathUtils.lerp(currentScale, targetScale, 0.1);
          sprite.scale.set(newScale, newScale, 1);

          sprite.material.opacity = THREE.MathUtils.lerp(
            sprite.material.opacity,
            blinkOpacity,
            0.1
          );
        });

        controls.update();
        renderer.render(scene, camera);
      }

      document.addEventListener("click", handleHotspotInteraction);
      document.addEventListener("touchend", handleHotspotInteraction);

      function handleHotspotInteraction(event) {
        event.preventDefault();
        
        let clientX, clientY;
        
        if (event.type === 'touchend') {
          if (event.changedTouches && event.changedTouches.length > 0) {
            clientX = event.changedTouches[0].clientX;
            clientY = event.changedTouches[0].clientY;
          } else {
            return;
          }
        } else {
          clientX = event.clientX;
          clientY = event.clientY;
        }
        
        const mouseClick = new THREE.Vector2(
          (clientX / window.innerWidth) * 2 - 1,
          -(clientY / window.innerHeight) * 2 + 1
        );

        const clickRaycaster = new THREE.Raycaster();
        clickRaycaster.setFromCamera(mouseClick, camera);
        const intersects = clickRaycaster.intersectObjects(spriteHotspots);

        if (intersects.length > 0) {
          const clicked = intersects[0].object;
          if (clicked.userData.onClick) clicked.userData.onClick();
        }
      }

      function hideTemp() {
        $("#tmp").fadeOut();
        setTimeout(function () {
          $("#tmpcontent").html("");
        }, 1000);
      }

      function showMedia(type, content) {
        switch (type) {
          case 1:
            $("#tmpcontent").html(
              "<img src='" + content + "' style='width: 100%;'>"
            );
            $("#tmp").fadeIn();
            break;
          case 2:
            $("#tmpcontent").html(
              "<video id='webvideo' controls autoplay style='width: 100%; height: 100%;'><source src='" +
                content +
                "' type='video/mp4'> Your browser does not support the video tag. </video>"
            );
            $("#tmp").fadeIn();
            break;
          case 3:
            $("#tmpcontent").html(
              "<audio controls style='width: 100%;'><source src='" +
                content +
                "' type='audio/ogg'>Your browser does not support the audio tag.</audio>"
            );
            $("#tmp").fadeIn();
            break;
        }
      }

      function startTourAt(panoramaName) {
        // Analytics tracking
        gtag('event', 'tour_started', {
          event_category: 'Virtual Tour',
          event_label: panoramaName,
          value: 1
        });
        
        document.getElementById("landingPage").classList.add("hidden");

        document.getElementById("homeButton").classList.add("visible");

        document.getElementById("hamburgerButton").classList.add("visible");

        audioPlayer.style.display = "block";

        setTimeout(() => {
          if (audioManager && !audioManager.isInitialized) {
            audioManager.play();
            audioManager.isInitialized = true;
          }
        }, 1000);

        setTimeout(() => {
          if (panoramaName !== "Titik_Utama.jpg") {
            switchPanorama(panoramaName);
          }
        }, 800);
      }

      function startDefaultTour() {
        startTourAt("Titik_Utama.jpg");
      }

      document.addEventListener("keydown", function (event) {
        const landingPage = document.getElementById("landingPage");
        if (landingPage && !landingPage.classList.contains("hidden")) {
          const key = event.key;
          if (key >= "1" && key <= "9") {
            const locations = [
              "Titik_Utama.jpg",
              "Auditorium_FMIPA.jpg",
              "Blue_Corner.jpg",
              "Depan_Biokim.jpg",
              "FPIK.jpg",
              "GOR.jpg",
              "International_Student_Center.jpg",
              "Lantai_1_AlHurriyyah.jpg",
              "Lantai_2_AlHurriyah.jpg",
            ];
            const index = parseInt(key) - 1;
            if (index < locations.length) {
              startTourAt(locations[index]);
            }
          } else if (key === "Enter" || key === " ") {
            event.preventDefault();
            startDefaultTour();
          }
        }
      });

      let currentAudioIndex = 0;
      let isPlaying = false;

      const audioFiles = [
        "audios/Allison&VexentoBananaBreeze.mp3",
        "audios/VexentoHome.mp3",
        "audios/VexentoNoTurningBack.mp3",
      ];

      const audioPlayer = document.getElementById("audioPlayer");
      let currentAudio = new Audio(audioFiles[currentAudioIndex]);
      function goToHome() {
        // Analytics tracking
        gtag('event', 'home_return', {
          event_category: 'Navigation',
          event_label: 'Return to Landing',
          value: 1
        });
        
        document.getElementById("landingPage").classList.remove("hidden");

        document.getElementById("homeButton").classList.remove("visible");

        document.getElementById("hamburgerButton").classList.remove("visible");

        closePanoList();

        if (document.getElementById("pano")) {
          document.getElementById("pano").style.display = "none";
        }

        if (window.viewer && window.viewer.destroy) {
          window.viewer.destroy();
          window.viewer = null;
        }

        if (currentAudio && !currentAudio.paused) {
          currentAudio.pause();
          isPlaying = false;
          document.getElementById("playPauseBtn").textContent = "▶";
        }

        audioPlayer.style.display = "none";

        console.log("Returned to landing page");
      }
    </script>
    <script>
      const panoramaList = [
        { file: "Titik_Utama.jpg", name: "Titik Utama", number: 1 },
        { file: "Auditorium_FMIPA.jpg", name: "Auditorium FMIPA", number: 2 },
        { file: "Blue_Corner.jpg", name: "Kantin Blue Corner", number: 3 },
        { file: "Depan_Biokim.jpg", name: "Gedung Biokimia", number: 4 },
        { file: "FPIK.jpg", name: "Gedung FPIK", number: 5 },
        { file: "GOR.jpg", name: "Gedung Olahraga (GOR)", number: 6 },
        {
          file: "International_Student_Center.jpg",
          name: "International Student Center",
          number: 7,
        },
        {
          file: "Lantai_1_AlHurriyyah.jpg",
          name: "Masjid Al-Hurriyyah Lt.1",
          number: 8,
        },
        {
          file: "Lantai_2_AlHurriyah.jpg",
          name: "Masjid Al-Hurriyyah Lt.2",
          number: 9,
        },
        {
          file: "Parkiran_AlHurriyyah.jpg",
          name: "Parkiran Masjid Al-Hurriyyah",
          number: 10,
        },
        { file: "Satari.jpg", name: "Gedung SATARI", number: 11 },
      ];

      $(document).ready(function () {
        let panoListHTML = `
          <div id="panolist">
            <div class="panolist-header">
              <div class="panolist-title">Pilih Lokasi</div>
              <div class="panolist-close" onclick="closePanoList()">
                <span>Tutup Menu</span>
                <i class="fa fa-chevron-left" style="margin-left: 8px;"></i>
              </div>
            </div>
            <div class="panolist-content">
        `;

        panoramaList.forEach((pano) => {
          panoListHTML += `
            <div class="pano-item" onclick="selectPanorama('${pano.file}')">
              <img src="panoramas/${pano.file}" alt="${pano.name}" class="pano-thumbnail" loading="lazy">
              <div class="pano-info">
                <div class="pano-name">${pano.name}</div>
                <div class="pano-number">Lokasi ${pano.number}</div>
              </div>
              <i class="fa fa-chevron-right pano-arrow"></i>
            </div>
          `;
        });

        panoListHTML += `
            </div>
          </div>
        `;

        $("body").append(panoListHTML);
      });

      let isAnimating = false;

      function togglePanoList() {
        if (isAnimating) return;

        const panolist = document.getElementById("panolist");
        const overlay = document.getElementById("panolistOverlay");

        if (panolist.classList.contains("open")) {
          closePanoList();
        } else {
          openPanoList();
        }
      }

      function openPanoList() {
        if (isAnimating) return;
        isAnimating = true;

        const panolist = document.getElementById("panolist");
        const overlay = document.getElementById("panolistOverlay");

        requestAnimationFrame(() => {
          panolist.classList.add("open");
          overlay.classList.add("active");

          setTimeout(() => {
            isAnimating = false;
          }, 400);
        });
      }

      function closePanoList() {
        if (isAnimating) return;
        isAnimating = true;

        const panolist = document.getElementById("panolist");
        const overlay = document.getElementById("panolistOverlay");

        requestAnimationFrame(() => {
          panolist.classList.remove("open");
          overlay.classList.remove("active");

          setTimeout(() => {
            isAnimating = false;
          }, 400);
        });
      }

      function selectPanorama(panoramaFile) {
        closePanoList();

        setTimeout(() => {
          switchPanorama(panoramaFile);
        }, 100);
      }

      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closePanoList();
        }
      });

      function initMobileTouchFix() {
        if (window.innerWidth <= 768) {
          const locationButtons = document.querySelectorAll('.location-btn');
          locationButtons.forEach(button => {
            const onclickAttr = button.getAttribute('onclick');
            if (onclickAttr) {
              const panoramaName = onclickAttr.match(/startTourAt\('([^']+)'\)/)[1];
              
              button.addEventListener('touchstart', function(e) {
                e.preventDefault();
                this.style.transform = 'scale(0.95)';
                this.style.background = 'rgba(235, 173, 6, 0.9)';
              });
              
              button.addEventListener('touchend', function(e) {
                e.preventDefault();
                this.style.transform = 'scale(1)';
                this.style.background = '';
                
                setTimeout(() => {
                  startTourAt(panoramaName);
                }, 50);
              });
              
              button.addEventListener('touchcancel', function(e) {
                this.style.transform = 'scale(1)';
                this.style.background = '';
              });
            }
          });
          
          const startTourBtn = document.querySelector('.start-tour-btn');
          if (startTourBtn) {
            startTourBtn.addEventListener('touchend', function(e) {
              e.preventDefault();
              setTimeout(() => {
                startDefaultTour();
              }, 50);
            });
          }
        }
      }

      document.addEventListener('DOMContentLoaded', initMobileTouchFix);
      window.addEventListener('resize', function() {
        if (window.innerWidth <= 768) {
          setTimeout(initMobileTouchFix, 100);
        }
      });
    </script>
  </body>
</html>
